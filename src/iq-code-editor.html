<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="codemirror-styles.html">

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/codemirror.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.26.0/mode/javascript/javascript.js"></script>

<dom-module id="iq-code-editor">
    <template>
        <style include="codemirror-styles">
        </style>
        <textarea id="code"></textarea>
        <button on-click="handleCheckMyCodeClick">Check my code</button>
    </template>
    <script>
        class CodeEditor extends Polymer.Element {
            static get is() { return "iq-code-editor"; }

            static get properties() {
                return {
                    functionName: {
                        type: String,
                        value: "solution"
                    },
                    variableName: {
                        type: String,
                        value: "someVariable"
                    },
                    codeEditor: {
                        type: CodeMirror
                    }
                }
            }

            handleCheckMyCodeClick() {
                this.dispatchEvent(new CustomEvent('checkCode', {detail: {code: this.codeEditor.getValue()}}));
            }

            connectedCallback() {
                super.connectedCallback();

                this.codeEditor = CodeMirror.fromTextArea(this.shadowRoot.querySelector("#code"), 
                {
                    mode:  "javascript",
                    lineNumbers: true,
                    gutters: ["CodeMirror-linenumbers"],
                    theme: "material"
                });

                this.codeEditor.setValue("function " + this.functionName + "(" + this.variableName + ") {\n\n}");
            }
        }

        window.customElements.define(CodeEditor.is, CodeEditor);
    </script>
</dom-module>